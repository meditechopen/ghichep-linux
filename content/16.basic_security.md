# Bảo mật Linux cơ bảnTheo mặc định, Linux có nhiều loại tài khoản để dung riêng cho các quy trình và khối lượng công việc:- root- system- normal- networkĐối với môi trường an toàn, bạn nên cấp các đặc quyền tối thiểu có thể và cần thiết cho các tài khoản và xóa các tài khoản không hoạt động. Các lệnh last cho thấy lần cuối cùng mỗi người dùng đăng nhập vào hệ thống, có thể được sử dụng để giúp xác định các tài khoản có khả năng không hoạt động ```sh# lastadriano  pts/4        10.10.10.113     Thu Feb 19 16:50   still logged inmina     pts/2        10.10.10.113     Thu Feb 19 16:39   still logged inroot     pts/1        10.10.10.113     Thu Feb 19 16:25 - 16:25  (00:00)root     pts/0        10.10.10.113     Thu Feb 19 15:42   still logged inadriano  pts/3        10.10.10.246     Wed Feb 18 17:53 - 18:44  (00:51)root     pts/2        10.10.10.99      Wed Feb 18 17:14 - 18:44  (01:30)adriano  pts/1        10.10.10.246     Wed Feb 18 16:57 - 19:19  (02:22)root     pts/0        10.10.10.246     Wed Feb 18 16:25 - 19:19  (02:53)root     pts/0        10.10.10.246     Tue Feb 17 13:29 - 19:29  (06:00)reboot   system boot  3.10.0-123.20.1. Tue Feb 17 13:28 - 17:20 (2+03:51)```Các tài khoản root là tài khoản đặc quyền nhất trên một hệ thống Linux / UNIX. Tài khoản này có khả năng thực hiện tất cả các khía cạnh của quản trị hệ thống, bao gồm thêm tài khoản, thay đổi mật khẩu người dùng, kiểm tra tệp nhật ký, cài đặt phần mềm, v.v.Người dùng tài khoản thông thường có thể thực hiện một số thao tác yêu cầu quyền đặc biệt; Tuy nhiên, cấu hình hệ thống phải cho phép thực hiện các khả năng như vậy. Chạy một mạng lưới khách hàng hoặc chia sẻ một tập tin trên mạng là các hoạt động mà không yêu cầu một tài khoản root.Trong Linux bạn có thể sử dụng lệnh suhoặc hoặc sudođể tạm thời cấp quyền truy cập root cho người dùng bình thường; Những phương pháp này thực sự là khá khác nhau. Khi sử dung lệnh su:- Để nâng cao đặc quyền, bạn cần phải nhập mật khẩu gốc. Cung cấp mật khẩu gốc cho người dùng bình thường nên không bao giờ, bao giờ được thực hiện- Một khi người dùng nâng lên tài khoản root, người dùng bình thường có thể làm bất cứ điều gì mà người dùng root có thể làm cho miễn là người dùng muốn, mà không cần hỏi lại mật khẩu- Có các tính năng khai thác logging hạn chếKhi sử dung lệnh sudo:- Bạn cần phải nhập mật khẩu của người dùng chứ không phải mật khẩu root- Những gì người dùng được phép làm có thể được kiểm soát chính xác và hạn chế; Theo mặc định, người dùng sẽ luôn phải giữ mật khẩu để thực hiện các thao tác tiếp theo sudo, hoặc có thể tránh làm như vậy trong một khoảng thời gian có thể định cấu hình- Tính năng đăng nhập chi tiết có sẵn# Lệnh sudoCấp các đặc quyền sử dung lệnh sudo ít nguy hiểm hơn su và nên được ưa thích. Theo mặc định, sudo phải được bật trên cơ sở mỗi người dùng. Tuy nhiên, một số bản phân phối (như Ubuntu) cho phép nó mặc định cho ít nhất một người dùng chính, hoặc đưa ra như là một tùy chọn cài đặt. Để thực hiện chỉ một lệnh với kiểu quyền root ``sudo <command>``. Khi lệnh hoàn tất, bạn sẽ trở lại với một người dùng bình thường không có đặc quyền. Các sudotệp cấu hình được lưu trữ trong tệp tin /etc/sudoers và trong thư mục /etc/sudoers.d/. Theo mặc định, thư mục đó trống rỗng.Các lệnh sudo có khả năng để theo dõi những nỗ lực không thành công tại đạt được quyền truy cập root. Thông báo lỗi xác thực sẽ xuất hiện trong tệp nhật ký /var/log/secure  khi cố gắng thực hiện sudo bash mà không xác thực thành công người dung```sh# tail /var/log/secureauthentication failure; logname=op uid=0 euid=0 tty=/dev/pts/6 ruser=op rhost= user=opconversation failedauth could not identify password for [op]op : 1 incorrect password attempt ;TTY=pts/6 ; PWD=/var/log ; USER=root ; COMMAND=/bin/bash```Bất cứ khi nào lệnh sudo được gọi ra, một trình kích hoạt sẽ xem xét /etc/sudoers và các tệp tin /etc/sudoers.d để xác định xem người dùng có quyền sử dụng sudovà phạm vi đặc quyền của họ là gì.Bạn có thể chỉnh sửa tệp sudoers bằng cách sử dụng lệnh visudo, đảm bảo rằng chỉ có một người đang chỉnh sửa tệp cùng một lúc, có quyền hợp lệ và từ chối ghi ra tệp và thoát nếu có lỗi trong các thay đổi được thực hiện. ```who where = (as_whom) what```Để tạo một tài khoản người dùng bình thường và cho nó quyền truy cập sudo, đăng nhập như là người dùng root và chỉnh sửa tập tin / etc / sudoers với lệnh visudo. Tìm các dòng trong tệp tin cấp quyền truy cập sudo cho người dùng trong nhóm wheel khi được bật.```sh## Allows people in group wheel to run all commands# %wheel        ALL=(ALL)       ALL```Xóa ký tự nhận xét ở đầu dòng thứ hai. Điều này cho phép tùy chọn cấu hình. Lưu thay đổi của bạn. Thêm người dùng bạn đã tạo vào nhóm wheel.```sh# usermod -aG wheel adriano# su adriano -$ groupsadriano wheel$ sudo whoamiWe trust you have received the usual lecture from the local SystemAdministrator. It usually boils down to these three things:    #1) Respect the privacy of others.    #2) Think before you type.    #3) With great power comes great responsibility.[sudo] password for adriano:root```Nếu sudo được cấu hình đúng, giá trị cuối cùng sẽ là root.Một số bản phân phối Linux thích bạn thêm một tập tin vào thư mục /etc/sudoers.d với một cái tên giống với người dùng. Tập tin này chứa cấu hình sudo của người dùng cá nhân và bạn nên để tệp tin cấu hình chính không bị ảnh hưởng trừ những thay đổi ảnh hưởng đến tất cả người dùng.# Quá trình cô lậpLinux được coi là an toàn hơn nhiều hệ điều hành khác vì các quy trình được tách biệt một cách tự nhiên. Một quá trình thường không thể truy cập các tài nguyên của quy trình khác, ngay cả khi quá trình đó đang chạy với các đặc quyền người dùng giống nhau. Các cơ chế bảo mật bổ sung đã được giới thiệu gần đây để làm cho rủi ro còn nhỏ hơn là:- Control Groups: Cho phép các quản trị viên hệ thống nhóm các quy trình và liên kết tài nguyên hữu hạn cho mỗi nhóm (cgroup).- Linux Containers:- Virtualization: #Mã hóa mật khẩuBảo vệ mật khẩu đã trở thành một phần quan trọng của an ninh. Hầu hết các bản phân phối Linux đều dựa vào thuật toán mật mã hóa hiện đại gọi là SHA-512 (Secure Hashing Algorithm 512 bits), được NSA tạo ra để mã hóa mật khẩu. Thuật toán SHA-512 được sử dụng rộng rãi cho các ứng dụng bảo mật và các giao thức. Các ứng dụng bảo mật và các giao thức này bao gồm TLS, SSL, PHP, SSH, S / MIME và IPSec. SHA-512 là một trong những thuật toán băm được kiểm tra nhiều nhất.# Mã hóa mật khẩuBảo vệ mật khẩu đã trở thành một phần quan trọng của an ninh. Hầu hết các bản phân phối Linux đều dựa vào thuật toán mật mã hóa hiện đại gọi là SHA-512 (Secure Hashing Algorithm 512 bits), được NSA tạo ra để mã hóa mật khẩu. Thuật toán SHA-512 được sử dụng rộng rãi cho các ứng dụng bảo mật và các giao thức. Các ứng dụng bảo mật và các giao thức này bao gồm TLS, SSL, PHP, SSH, S / MIME và IPSec. SHA-512 là một trong những thuật toán băm được kiểm tra nhiều nhất.# Public/Private Keys for AuthenticationSử dụng các khóa mã hóa để xác thực cung cấp hai lợi ích chính. - Thứ nhất, nó là thuận tiện vì bạn không còn cần phải nhập mật khẩu nếu bạn sử dụng khóa public / private. - Thứ hai, khi xác thực cặp khoá public / private được thiết lập trên máy chủ, bạn có thể vô hiệu hóa xác thực mật khẩu hoàn toàn có nghĩa là không có khoá được ủy quyền mà bạn không thể truy cập.Tạo một khóa private cho client và public cho server```sh# ssh-keygen -t rsaGenerating public/private rsa key pair.Enter file in which to save the key (/root/.ssh/id_rsa):Enter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in /root/.ssh/id_rsa.Your public key has been saved in /root/.ssh/id_rsa.pub.# cd /root/.ssh# lltotal 8-rw------- 1 root root    0 May 30 11:17 authorized_keys-rw------- 1 root root 1675 May 30 11:17 id_rsa-rw-r--r-- 1 root root  396 May 30 11:17 id_rsa.pub-rw-r--r-- 1 root root    0 May 30 11:07 known_hosts# chmod 700 ~/.ssh# chmod 600 ~/.ssh/id_rsa```Điều này sẽ tạo ra hai tệp tin trong thư mục .ssh của bạn được gọi là: id_rsa và id_rsa.pub. Đầu tiên là khóa cá nhân của bạn và khóa kia là khóa công khai của bạn. Cài đặt khoá công khai vào danh sách khóa được ủy quyền và sau đó xóa nó khỏi máy chủ```sh# cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys# rm -rf ~/.ssh/id_rsa.pub```Vui lòng lưu ý rằng cùng một khóa công khai có thể được cài đặt cho nhiều máy chủ, chỉ cần sao chép nó trên máy chủ đó và cài đặt vào danh sách khoá được ủy quyền.Sao chép khóa cá nhân trên máy khách mà bạn sẽ sử dụng để kết nối với máy chủ và sau đó gỡ bỏ nó khỏi máy chủ```sh# scp ~/.ssh/id_rsa root@clientmachine:root/.ssh/# rm -rf ~/.ssh/id_rsa```Trên máy khách Linux và Unix, sử dụng khóa cá nhân để đăng nhập vào máy chủ```# ssh -i ~/.ssh/id_rsa root@servermachine```Trên máy khách Windows, sử dụng công cụ puttygen để làm chìa khóa ở định dạng thích hợp và sử dụng ứng dụng Putty để đăng nhập vào máy chủ. Xin lưu ý rằng mỗi người dùng muốn đăng nhập phải có cặp chính của chính mình.